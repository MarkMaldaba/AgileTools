[%# This Source Code Form is subject to the terms of the Mozilla Public
  # License, v. 2.0. If a copy of the MPL was not distributed with this
  # file, You can obtain one at http://mozilla.org/MPL/2.0/.
  #
  # Copyright (C) 2012 Jolla Ltd.
  # Contact: Pami Ketolainen <pami.ketolainen@jollamobile.com>
  #%]

[% javascript = BLOCK %]

/**
 * Page script entry point
 */
$(function() {
    $("button.editor-toggle").click(function(){
        $(".editor").toggle();
    });
    var team = new Team([% team_json %]);
});

[% END %]

[% INCLUDE global/header.html.tmpl
    title = "Team $team.name",
    style_urls = [
        "extensions/AgileTools/web/css/base.css",
        ],
    javascript_urls = [
        "extensions/AgileTools/web/js/team.js",
        ],
%]

<div id="templates">
<table>
    <tr id="member_template">
        <td class="name"></td>
        <td>
            <button class="editor remove" type="button">Remove member</button>
        </td>
        <td>
            <ul class="roles">
                <li class="editor">
                    <select class="role-new">
                        <option value=""></option>
                    [% FOREACH role IN roles %]
                        <option value="[% role.id %]">[% role.name FILTER html %]</option>
                    [% END %]
                    </select>
                    <button class="add" type="button">Add role</button>
                </li>
            </ul>
        </td>
    </tr>
    
    <li id="role_template">
        <span class="name"></span>
        <button class="editor remove" type="button">Remove role</button>
    </li>

    <tr id="responsibility_template">
        <td class="name"></td>
        <td class="editor">
            <button type="button" class="remove">Remove</button>
        </td>
    </tr>
</table>

</div>

<h1>Team [% team.name FILTER html %]</h1>

[% TRY %]
    [% PROCESS "agiletools/process/${team.process_id}_summary_links.html.tmpl" %]
[% CATCH %]
        <b>Failed to display team summary!</b><br/>
        [% error.type FILTER html %]: [% error.info FILTER html %]
[% END %]

[% IF team.user_can_edit %]
<div class="editor">
    <h2>Add backlogs</h2>
    <input id="new_backlog" type="text"/>
    <button class="add" type="button" id="add_new_backlog"
        >Create new backlog</button><br/>
    [% IF available_backlogs.size %]
    <select id="existing_backlog">
        [% FOREACH bl IN available_backlogs %]
        <option value="[% bl.id %]">[% bl.name FILTER html %]</option>
        [% END %]
    </select>
    <button class="add" type="button" id="add_existing_backlog"
        >Add existing backlog</button><br/>
    [% END %]
</div>
[% END %]

<h2>Members</h2>
<table id="team_members" class="team_info">
    <thead>
        <tr>
            <th>Name</th>
            <th></th>
            <th>Roles</th>
        </tr>
    </thead>
    <tbody>
        <tr class="editor">
        [% IF team.user_can_edit %]
            <td>
                <input class="member-new">
            </td>
            <td>
                <button class="add" type="button">Add member</button>
            </td>
            <td></td>
        [% END %]
        </tr>
    </tbody>
</table>
</ul>

<h2>Responsibilities</h2>
<table id="team_components"  class="team_info">
    <thead>
        <tr>
            <th>Components</th>
        </tr>
    </thead>
    <tbody>
        <tr class="editor">
            [% IF team.user_can_edit %]
            <td>
                <select class="component-new"/>
                    <option value=""></option>
                [% FOREACH component IN components %]
                    <option value="[% component.id %]">[% component.name FILTER html %]</option>
                [% END %]
                </select>
            </td>
            <td><button type="button" class="add">Add</button></td>
            [% END %]
        </tr>
    </tbody>
</table>
<table id="team_keywords"  class="team_info">
    <thead>
        <tr>
            <th>Keywords</th>
        </tr>
    </thead>
    <tbody>
        <tr class="editor">
            [% IF team.user_can_edit %]
            <td>
                <select class="keyword-new"/>
                    <option value=""></option>
                [% FOREACH keyword IN keywords %]
                    <option value="[% keyword.id %]">[% keyword.name FILTER html %]</option>
                [% END %]
                </select>
            </td>
            <td><button type="button" class="add">Add</button></td>
            [% END %]
        </tr>
    </tbody>
</table>
[% IF team.user_can_edit %]
<button class="editor-toggle" type="button">Show/Hide Editing</button><br/>
[% END %]

<a href="page.cgi?id=agiletools/team/list.html">Back to team list</a>

[% INCLUDE global/footer.html.tmpl %]

